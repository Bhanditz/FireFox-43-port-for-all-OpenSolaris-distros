diff -Nurb 000__VANILLA/mozilla-beta/dom/media/AudioStream.cpp 001__PORTED/mozilla-beta/dom/media/AudioStream.cpp
--- 000__VANILLA/mozilla-beta/dom/media/AudioStream.cpp	2015-03-06 04:30:43.000000000 +0100
+++ 001__PORTED/mozilla-beta/dom/media/AudioStream.cpp	2015-03-10 14:40:27.000000000 +0100
@@ -14,7 +14,6 @@
 #include "mozilla/Mutex.h"
 #include <algorithm>
 #include "mozilla/Telemetry.h"
-#include "soundtouch/SoundTouch.h"
 #include "Latency.h"
 #include "CubebUtils.h"
 #include "nsPrintfCString.h"
diff -Nurb 000__VANILLA/mozilla-beta/dom/media/AudioStream.h 001__PORTED/mozilla-beta/dom/media/AudioStream.h
--- 000__VANILLA/mozilla-beta/dom/media/AudioStream.h	2015-03-06 04:30:43.000000000 +0100
+++ 001__PORTED/mozilla-beta/dom/media/AudioStream.h	2015-03-10 14:38:55.000000000 +0100
@@ -16,9 +16,7 @@
 #include "mozilla/UniquePtr.h"
 #include "CubebUtils.h"
 
-namespace soundtouch {
-class SoundTouch;
-}
+#include "soundtouch/SoundTouch.h"
 
 namespace mozilla {
 
diff -Nurb 000__VANILLA/mozilla-beta/dom/plugins/base/npapi.h 001__PORTED/mozilla-beta/dom/plugins/base/npapi.h
--- 000__VANILLA/mozilla-beta/dom/plugins/base/npapi.h	2015-03-06 04:30:44.000000000 +0100
+++ 001__PORTED/mozilla-beta/dom/plugins/base/npapi.h	2015-03-30 06:36:15.386640000 +0200
@@ -283,7 +283,7 @@
  *   gcc 3.x generated vtables on UNIX and OSX are incompatible with
  *   previous compilers.
  */
-#if (defined(XP_UNIX) && defined(__GNUC__) && (__GNUC__ >= 3))
+#if (defined(XP_UNIX) && defined(__GNUC__) && (__GNUC__ == 3))
 #define _NP_ABI_MIXIN_FOR_GCC3 NP_ABI_GCC3_MASK
 #else
 #define _NP_ABI_MIXIN_FOR_GCC3 0
diff -Nurb 000__VANILLA/mozilla-beta/dom/plugins/ipc/PluginModuleChild.cpp 001__PORTED/mozilla-beta/dom/plugins/ipc/PluginModuleChild.cpp
--- 000__VANILLA/mozilla-beta/dom/plugins/ipc/PluginModuleChild.cpp	2015-03-06 04:30:44.000000000 +0100
+++ 001__PORTED/mozilla-beta/dom/plugins/ipc/PluginModuleChild.cpp	2015-03-27 14:22:00.369730000 +0100
@@ -320,7 +320,7 @@
 
     // TODO: use PluginPRLibrary here
 
-#if defined(OS_LINUX) || defined(OS_BSD)
+#if defined(OS_LINUX) || defined(OS_BSD) || defined(OS_SOLARIS)
     mShutdownFunc =
         (NP_PLUGINSHUTDOWN) PR_FindFunctionSymbol(mLibrary, "NP_Shutdown");
 
@@ -351,9 +351,11 @@
 }
 
 #if defined(MOZ_WIDGET_GTK)
+extern "C" {
 typedef void (*GObjectDisposeFn)(GObject*);
 typedef gboolean (*GtkWidgetScrollEventFn)(GtkWidget*, GdkEventScroll*);
 typedef void (*GtkPlugEmbeddedFn)(GtkPlug*);
+}
 
 static GObjectDisposeFn real_gtk_plug_dispose;
 static GtkPlugEmbeddedFn real_gtk_plug_embedded;
@@ -1882,7 +1884,7 @@
     AssertPluginThread();
     MOZ_ASSERT(mIsChrome);
 
-#if defined(OS_LINUX) || defined(OS_BSD)
+#if defined(OS_LINUX) || defined(OS_BSD) || defined(OS_SOLARIS)
     return true;
 #elif defined(OS_WIN) || defined(OS_MACOSX)
     *_retval = mGetEntryPointsFunc(&mFunctions);
@@ -1927,7 +1929,7 @@
 #endif
 
     NPError result;
-#if defined(OS_LINUX) || defined(OS_BSD)
+#if defined(OS_LINUX) || defined(OS_BSD) || defined(OS_SOLARIS)
     result = mInitializeFunc(&sBrowserFuncs, &mFunctions);
 #elif defined(OS_WIN) || defined(OS_MACOSX)
     result = mInitializeFunc(&sBrowserFuncs);
diff -Nurb 000__VANILLA/mozilla-beta/dom/plugins/ipc/PluginModuleChild.h 001__PORTED/mozilla-beta/dom/plugins/ipc/PluginModuleChild.h
--- 000__VANILLA/mozilla-beta/dom/plugins/ipc/PluginModuleChild.h	2015-03-06 04:30:44.000000000 +0100
+++ 001__PORTED/mozilla-beta/dom/plugins/ipc/PluginModuleChild.h	2015-03-07 08:01:02.000000000 +0100
@@ -326,7 +326,7 @@
 
     // we get this from the plugin
     NP_PLUGINSHUTDOWN mShutdownFunc;
-#if defined(OS_LINUX) || defined(OS_BSD)
+#if defined(OS_LINUX) || defined(OS_BSD) || defined(OS_SOLARIS)
     NP_PLUGINUNIXINIT mInitializeFunc;
 #elif defined(OS_WIN) || defined(OS_MACOSX)
     NP_PLUGININIT mInitializeFunc;
diff -Nurb 000__VANILLA/mozilla-beta/ipc/chromium/chromium-config.mozbuild 001__PORTED/mozilla-beta/ipc/chromium/chromium-config.mozbuild
--- 000__VANILLA/mozilla-beta/ipc/chromium/chromium-config.mozbuild	2015-03-06 04:30:37.000000000 +0100
+++ 001__PORTED/mozilla-beta/ipc/chromium/chromium-config.mozbuild	2015-03-01 14:50:01.123683000 +0100
@@ -69,5 +69,11 @@
             'OS_BSD': 1,
         })
 
+    elif CONFIG['OS_ARCH'] == 'SunOS':
+        DEFINES.update({
+            'OS_SOLARIS': 1,
+            'OS_POSIX': 1,
+        })
+
     else:
         DEFINES['OS_LINUX'] = 1
diff -Nurb 000__VANILLA/mozilla-beta/ipc/chromium/src/base/file_util_posix.cc 001__PORTED/mozilla-beta/ipc/chromium/src/base/file_util_posix.cc
--- 000__VANILLA/mozilla-beta/ipc/chromium/src/base/file_util_posix.cc	2015-03-06 04:30:37.000000000 +0100
+++ 001__PORTED/mozilla-beta/ipc/chromium/src/base/file_util_posix.cc	2015-03-30 05:14:54.523094000 +0200
@@ -79,9 +79,9 @@
     return false;
   }
   char* dir_list[2] = { top_dir, NULL };
-  FTS* fts = fts_open(dir_list, ftsflags, NULL);
+  FTS* fts = _ast_fts_open(dir_list, ftsflags, NULL);
   if (fts) {
-    FTSENT* fts_ent = fts_read(fts);
+    FTSENT* fts_ent = _ast_fts_read(fts);
     while (success && fts_ent != NULL) {
       switch (fts_ent->fts_info) {
         case FTS_DNR:
@@ -105,9 +105,9 @@
           DCHECK(false);
           break;
       }
-      fts_ent = fts_read(fts);
+      fts_ent = _ast_fts_read(fts);
     }
-    fts_close(fts);
+    _ast_fts_close(fts);
   }
   return success;
 #endif
@@ -145,15 +145,15 @@
   return false;
 #else
   char* dir_list[] = { top_dir, NULL };
-  FTS* fts = fts_open(dir_list, FTS_PHYSICAL | FTS_NOSTAT, NULL);
+  FTS* fts = _ast_fts_open(dir_list, FTS_PHYSICAL | FTS_NOSTAT, NULL);
   if (!fts) {
-    CHROMIUM_LOG(ERROR) << "fts_open failed: " << strerror(errno);
+    CHROMIUM_LOG(ERROR) << "_ast_fts_open failed: " << strerror(errno);
     return false;
   }
 
   int error = 0;
   FTSENT* ent;
-  while (!error && (ent = fts_read(fts)) != NULL) {
+  while (!error && (ent = _ast_fts_read(fts)) != NULL) {
     // ent->fts_path is the source path, including from_path, so paste
     // the suffix after from_path onto to_path to create the target_path.
     std::string suffix(&ent->fts_path[from_path.value().size()]);
@@ -168,7 +168,7 @@
         // If we encounter a subdirectory in a non-recursive copy, prune it
         // from the traversal.
         if (!recursive && ent->fts_level > 0) {
-          if (fts_set(fts, ent, FTS_SKIP) != 0)
+          if (_ast_fts_set(fts, ent, FTS_SKIP) != 0)
             error = errno;
           continue;
         }
@@ -192,7 +192,7 @@
         continue;
       case FTS_DC:   // Directory causing a cycle.
         // Skip this branch.
-        if (fts_set(fts, ent, FTS_SKIP) != 0)
+        if (_ast_fts_set(fts, ent, FTS_SKIP) != 0)
           error = errno;
         break;
       case FTS_DNR:  // Directory cannot be read.
@@ -215,13 +215,13 @@
         continue;  // Hope for the best!
     }
   }
-  // fts_read may have returned NULL and set errno to indicate an error.
+  // _ast_fts_read may have returned NULL and set errno to indicate an error.
   if (!error && errno != 0)
     error = errno;
 
-  if (!fts_close(fts)) {
+  if (!_ast_fts_close(fts)) {
     // If we already have an error, let's use that error instead of the error
-    // fts_close set.
+    // _ast_fts_close set.
     if (!error)
       error = errno;
   }
diff -Nurb 000__VANILLA/mozilla-beta/ipc/chromium/src/base/message_loop.cc 001__PORTED/mozilla-beta/ipc/chromium/src/base/message_loop.cc
--- 000__VANILLA/mozilla-beta/ipc/chromium/src/base/message_loop.cc	2015-03-06 04:30:37.000000000 +0100
+++ 001__PORTED/mozilla-beta/ipc/chromium/src/base/message_loop.cc	2015-03-30 05:19:14.429892000 +0200
@@ -19,7 +19,7 @@
 #if defined(OS_POSIX)
 #include "base/message_pump_libevent.h"
 #endif
-#if defined(OS_LINUX) || defined(OS_BSD)
+#if defined(OS_LINUX) || defined(OS_BSD) || defined(OS_SOLARIS)
 #if defined(MOZ_WIDGET_GTK)
 #include "base/message_pump_glib.h"
 #endif
@@ -144,7 +144,7 @@
   if (type_ == TYPE_UI) {
 #if defined(OS_MACOSX)
     pump_ = base::MessagePumpMac::Create();
-#elif defined(OS_LINUX) || defined(OS_BSD)
+#elif defined(OS_LINUX) || defined(OS_BSD) || defined(OS_SOLARIS)
     pump_ = new base::MessagePumpForUI();
 #endif  // OS_LINUX
   } else if (type_ == TYPE_IO) {
diff -Nurb 000__VANILLA/mozilla-beta/ipc/chromium/src/base/message_pump_glib.cc 001__PORTED/mozilla-beta/ipc/chromium/src/base/message_pump_glib.cc
--- 000__VANILLA/mozilla-beta/ipc/chromium/src/base/message_pump_glib.cc	2015-03-06 04:30:37.000000000 +0100
+++ 001__PORTED/mozilla-beta/ipc/chromium/src/base/message_pump_glib.cc	2015-03-07 05:16:04.000000000 +0100
@@ -4,6 +4,7 @@
 
 #include "base/message_pump_glib.h"
 
+#include <unistd.h>
 #include <fcntl.h>
 #include <math.h>
 
@@ -128,6 +129,12 @@
   // Create our wakeup pipe, which is used to flag when work was scheduled.
   int fds[2];
   CHECK(pipe(fds) == 0);
+
+  int flags = fcntl(fds[0], F_GETFL, 0);
+  if (flags == -1)
+    flags = 0;
+  fcntl(fds[0], F_SETFL, flags | O_NDELAY);
+
   wakeup_pipe_read_  = fds[0];
   wakeup_pipe_write_ = fds[1];
   wakeup_gpollfd_->fd = wakeup_pipe_read_;
@@ -234,10 +241,9 @@
   // are only signaled when the queue went from empty to non-empty.  The glib
   // poll will tell us whether there was data, so this read shouldn't block.
   if (wakeup_gpollfd_->revents & G_IO_IN) {
-    char msg;
-    if (HANDLE_EINTR(read(wakeup_pipe_read_, &msg, 1)) != 1 || msg != '!') {
-      NOTREACHED() << "Error reading from the wakeup pipe.";
-    }
+    char buf[32];
+    while (HANDLE_EINTR(read(wakeup_pipe_read_, &buf, 32)));
+
     // Since we ate the message, we need to record that we have more work,
     // because HandleCheck() may be called without HandleDispatch being called
     // afterwards.
@@ -301,6 +307,10 @@
   // variables as we would then need locks all over.  This ensures that if
   // we are sleeping in a poll that we will wake up.
   char msg = '!';
+  char buf[32];
+
+  while (HANDLE_EINTR(read(wakeup_pipe_read_, &buf, 32)));
+
   if (HANDLE_EINTR(write(wakeup_pipe_write_, &msg, 1)) != 1) {
     NOTREACHED() << "Could not write to the UI message loop wakeup pipe!";
   }
diff -Nurb 000__VANILLA/mozilla-beta/ipc/chromium/src/base/message_pump_libevent.cc 001__PORTED/mozilla-beta/ipc/chromium/src/base/message_pump_libevent.cc
--- 000__VANILLA/mozilla-beta/ipc/chromium/src/base/message_pump_libevent.cc	2015-03-06 04:30:37.000000000 +0100
+++ 001__PORTED/mozilla-beta/ipc/chromium/src/base/message_pump_libevent.cc	2015-03-30 05:26:38.970034000 +0200
@@ -6,6 +6,10 @@
 
 #include <errno.h>
 #include <fcntl.h>
+#if defined(OS_SOLARIS)
+#include <unistd.h>
+#include <sys/stat.h>
+#endif
 #if defined(ANDROID) || defined(OS_POSIX)
 #include <unistd.h>
 #endif
diff -Nurb 000__VANILLA/mozilla-beta/ipc/chromium/src/base/platform_thread.h 001__PORTED/mozilla-beta/ipc/chromium/src/base/platform_thread.h
--- 000__VANILLA/mozilla-beta/ipc/chromium/src/base/platform_thread.h	2015-03-06 04:30:37.000000000 +0100
+++ 001__PORTED/mozilla-beta/ipc/chromium/src/base/platform_thread.h	2015-03-30 05:17:30.300429000 +0200
@@ -25,6 +25,9 @@
 #if defined(OS_LINUX) || defined(OS_OPENBSD) || defined(__GLIBC__)
 #include <unistd.h>
 typedef pid_t PlatformThreadId;
+#elif defined(OS_SOLARIS)
+#include <sys/lwp.h>
+typedef lwpid_t PlatformThreadId;
 #elif defined(OS_BSD)
 #include <sys/types.h>
 typedef lwpid_t PlatformThreadId;
diff -Nurb 000__VANILLA/mozilla-beta/ipc/chromium/src/base/platform_thread_posix.cc 001__PORTED/mozilla-beta/ipc/chromium/src/base/platform_thread_posix.cc
--- 000__VANILLA/mozilla-beta/ipc/chromium/src/base/platform_thread_posix.cc	2015-03-06 04:30:37.000000000 +0100
+++ 001__PORTED/mozilla-beta/ipc/chromium/src/base/platform_thread_posix.cc	2015-03-30 05:28:11.470448000 +0200
@@ -10,7 +10,13 @@
 #if defined(OS_MACOSX)
 #include <mach/mach.h>
 #elif defined(OS_NETBSD)
+_Pragma("GCC visibility push(default)")
 #include <lwp.h>
+_Pragma("GCC visibility pop")
+#elif defined(OS_SOLARIS)
+_Pragma("GCC visibility push(default)")
+#include <sys/lwp.h>
+_Pragma("GCC visibility pop")
 #elif defined(OS_LINUX)
 #include <sys/syscall.h>
 #include <sys/prctl.h>
@@ -27,6 +33,12 @@
 #include <pthread_np.h>
 #endif
 
+#if defined(OS_SOLARIS)
+#include <sys/syscall.h>
+#include <unistd.h>
+#include <thread.h>
+#endif
+
 #if defined(OS_MACOSX)
 namespace base {
 void InitThreading();
@@ -54,6 +66,8 @@
 #else
   return syscall(__NR_gettid);
 #endif
+#elif defined(OS_SOLARIS)
+  return thr_self();
 #elif defined(OS_OPENBSD) || defined(__GLIBC__)
   return (intptr_t) (pthread_self());
 #elif defined(OS_NETBSD)
@@ -114,7 +128,8 @@
   pthread_setname_np(pthread_self(), "%s", (void *)name);
 #elif defined(OS_BSD) && !defined(__GLIBC__)
   pthread_set_name_np(pthread_self(), name);
-#else
+#elif !defined(OS_SOLARIS)
+  prctl(PR_SET_NAME, reinterpret_cast<uintptr_t>(name), 0, 0, 0);
 #endif
 }
 #endif // !OS_MACOSX
diff -Nurb 000__VANILLA/mozilla-beta/ipc/chromium/src/base/process_util.h 001__PORTED/mozilla-beta/ipc/chromium/src/base/process_util.h
--- 000__VANILLA/mozilla-beta/ipc/chromium/src/base/process_util.h	2015-03-06 04:30:37.000000000 +0100
+++ 001__PORTED/mozilla-beta/ipc/chromium/src/base/process_util.h	2015-03-30 05:23:01.798554000 +0200
@@ -17,7 +17,7 @@
 #ifndef STDOUT_FILENO
 #define STDOUT_FILENO 1
 #endif
-#elif defined(OS_LINUX) || defined(__GLIBC__)
+#elif defined(OS_LINUX) || defined(OS_SOLARIS) || defined(__GLIBC__)
 #include <dirent.h>
 #include <limits.h>
 #include <sys/types.h>
@@ -25,6 +25,10 @@
 #include <mach/mach.h>
 #endif
 
+#if defined(OS_SOLARIS)
+#define NAME_MAX 14
+#endif
+
 #include <map>
 #include <string>
 #include <vector>
diff -Nurb 000__VANILLA/mozilla-beta/ipc/chromium/src/base/process_util_posix.cc 001__PORTED/mozilla-beta/ipc/chromium/src/base/process_util_posix.cc
--- 000__VANILLA/mozilla-beta/ipc/chromium/src/base/process_util_posix.cc	2015-03-06 04:30:37.000000000 +0100
+++ 001__PORTED/mozilla-beta/ipc/chromium/src/base/process_util_posix.cc	2015-03-30 05:29:29.586960000 +0200
@@ -116,7 +116,7 @@
 #if defined(ANDROID)
   static const rlim_t kSystemDefaultMaxFds = 1024;
   static const char kFDDir[] = "/proc/self/fd";
-#elif defined(OS_LINUX)
+#elif defined(OS_LINUX) || defined(OS_SOLARIS)
   static const rlim_t kSystemDefaultMaxFds = 8192;
   static const char kFDDir[] = "/proc/self/fd";
 #elif defined(OS_MACOSX)
@@ -208,7 +208,7 @@
 // TODO(agl): Remove this function. It's fundamentally broken for multithreaded
 // apps.
 void SetAllFDsToCloseOnExec() {
-#if defined(OS_LINUX)
+#if defined(OS_LINUX) || defined(OS_SOLARIS)
   const char fd_dir[] = "/proc/self/fd";
 #elif defined(OS_MACOSX) || defined(OS_BSD)
   const char fd_dir[] = "/dev/fd";
diff -Nurb 000__VANILLA/mozilla-beta/ipc/chromium/src/base/sys_info_posix.cc 001__PORTED/mozilla-beta/ipc/chromium/src/base/sys_info_posix.cc
--- 000__VANILLA/mozilla-beta/ipc/chromium/src/base/sys_info_posix.cc	2015-03-06 04:30:37.000000000 +0100
+++ 001__PORTED/mozilla-beta/ipc/chromium/src/base/sys_info_posix.cc	2015-03-07 05:24:21.000000000 +0100
@@ -119,7 +119,7 @@
 
 // static
 std::string SysInfo::OperatingSystemName() {
-  utsname info;
+  struct utsname info;
   if (uname(&info) < 0) {
     NOTREACHED();
     return "";
@@ -129,7 +129,7 @@
 
 // static
 std::string SysInfo::OperatingSystemVersion() {
-  utsname info;
+  struct utsname info;
   if (uname(&info) < 0) {
     NOTREACHED();
     return "";
@@ -139,7 +139,7 @@
 
 // static
 std::string SysInfo::CPUArchitecture() {
-  utsname info;
+  struct utsname info;
   if (uname(&info) < 0) {
     NOTREACHED();
     return "";
diff -Nurb 000__VANILLA/mozilla-beta/ipc/chromium/src/base/time.h 001__PORTED/mozilla-beta/ipc/chromium/src/base/time.h
--- 000__VANILLA/mozilla-beta/ipc/chromium/src/base/time.h	2015-03-06 04:30:37.000000000 +0100
+++ 001__PORTED/mozilla-beta/ipc/chromium/src/base/time.h	2015-03-07 05:54:06.000000000 +0100
@@ -62,6 +62,10 @@
     return delta_;
   }
 
+#if defined(OS_POSIX)
+  struct timespec ToTimeSpec() const;
+#endif
+
   // Returns the time delta in some unit. The F versions return a floating
   // point value, the "regular" versions return a rounded-down value.
   int InDays() const;
@@ -224,6 +228,9 @@
   static Time FromDoubleT(double dt);
   double ToDoubleT() const;
 
+#if defined(OS_POSIX)
+  struct timeval ToTimeVal() const;
+#endif
 
 #if defined(OS_WIN)
   static Time FromFileTime(FILETIME ft);
diff -Nurb 000__VANILLA/mozilla-beta/ipc/chromium/src/base/time_posix.cc 001__PORTED/mozilla-beta/ipc/chromium/src/base/time_posix.cc
--- 000__VANILLA/mozilla-beta/ipc/chromium/src/base/time_posix.cc	2015-03-06 04:30:37.000000000 +0100
+++ 001__PORTED/mozilla-beta/ipc/chromium/src/base/time_posix.cc	2015-03-30 05:25:02.579865000 +0200
@@ -65,11 +65,13 @@
   timestruct.tm_wday   = exploded.day_of_week;  // mktime/timegm ignore this
   timestruct.tm_yday   = 0;     // mktime/timegm ignore this
   timestruct.tm_isdst  = -1;    // attempt to figure it out
+#ifndef OS_SOLARIS
   timestruct.tm_gmtoff = 0;     // not a POSIX field, so mktime/timegm ignore
   timestruct.tm_zone   = NULL;  // not a POSIX field, so mktime/timegm ignore
+#endif
 
   time_t seconds;
-#ifdef ANDROID
+#if defined(ANDROID) || defined(OS_SOLARIS)
     seconds = mktime(&timestruct);
 #else
   if (is_local)
@@ -167,7 +169,7 @@
   // With numer and denom = 1 (the expected case), the 64-bit absolute time
   // reported in nanoseconds is enough to last nearly 585 years.
 
-#elif defined(OS_OPENBSD) || defined(OS_POSIX) && \
+#elif defined(OS_OPENBSD) || defined(OS_SOLARIS) || defined(OS_POSIX) && \
       defined(_POSIX_MONOTONIC_CLOCK) && _POSIX_MONOTONIC_CLOCK >= 0
 
   struct timespec ts;
@@ -192,4 +194,25 @@
   return Now();
 }
 
+struct timespec TimeDelta::ToTimeSpec() const {
+  int64_t microseconds = InMicroseconds();
+  time_t seconds = 0;
+  if (microseconds >= Time::kMicrosecondsPerSecond) {
+    seconds = InSeconds();
+    microseconds -= seconds * Time::kMicrosecondsPerSecond;
+  }
+  struct timespec result =
+      {seconds,
+       microseconds * Time::kNanosecondsPerMicrosecond};
+  return result;
+}
+
+struct timeval Time::ToTimeVal() const {
+  struct timeval result;
+  int64_t us = us_ - kTimeTToMicrosecondsOffset;
+  result.tv_sec = us / Time::kMicrosecondsPerSecond;
+  result.tv_usec = us % Time::kMicrosecondsPerSecond;
+  return result;
+}
+
 }  // namespace base
diff -Nurb 000__VANILLA/mozilla-beta/ipc/chromium/src/build/build_config.h 001__PORTED/mozilla-beta/ipc/chromium/src/build/build_config.h
--- 000__VANILLA/mozilla-beta/ipc/chromium/src/build/build_config.h	2015-03-06 04:30:37.000000000 +0100
+++ 001__PORTED/mozilla-beta/ipc/chromium/src/build/build_config.h	2015-03-28 15:41:04.445987000 +0100
@@ -30,6 +30,8 @@
 #define OS_NETBSD 1
 #elif defined(__OpenBSD__)
 #define OS_OPENBSD 1
+#elif defined(__sun__) || defined(__sun)
+#define OS_SOLARIS 1
 #elif defined(_WIN32)
 #define OS_WIN 1
 #else
@@ -45,7 +47,7 @@
 
 // For access to standard POSIX features, use OS_POSIX instead of a more
 // specific macro.
-#if defined(OS_MACOSX) || defined(OS_LINUX) || defined(OS_BSD)
+#if defined(OS_MACOSX) || defined(OS_LINUX) || defined(OS_BSD) || defined(OS_SOLARIS)
 #define OS_POSIX 1
 #endif
 
diff -Nurb 000__VANILLA/mozilla-beta/ipc/chromium/src/chrome/common/transport_dib.h 001__PORTED/mozilla-beta/ipc/chromium/src/chrome/common/transport_dib.h
--- 000__VANILLA/mozilla-beta/ipc/chromium/src/chrome/common/transport_dib.h	2015-03-06 04:30:37.000000000 +0100
+++ 001__PORTED/mozilla-beta/ipc/chromium/src/chrome/common/transport_dib.h	2015-03-30 05:12:59.931262000 +0200
@@ -13,7 +13,7 @@
 
 #if defined(OS_WIN)
 #include <windows.h>
-#elif defined(OS_LINUX)
+#elif defined(OS_LINUX) || defined(OS_SOLARIS)
 #include "chrome/common/x11_util.h"
 #endif
 
@@ -66,7 +66,7 @@
   typedef base::SharedMemoryHandle Handle;
   // On Mac, the inode number of the backing file is used as an id.
   typedef base::SharedMemoryId Id;
-#elif defined(OS_LINUX)
+#elif defined(OS_LINUX) || defined(OS_SOLARIS)
   typedef int Handle;  // These two ints are SysV IPC shared memory keys
   typedef int Id;
 #endif
@@ -96,7 +96,7 @@
   // wire to give this transport DIB to another process.
   Handle handle() const;
 
-#if defined(OS_LINUX)
+#if defined(OS_LINUX) || defined(OS_SOLARIS)
   // Map the shared memory into the X server and return an id for the shared
   // segment.
   XID MapToX(Display* connection);
@@ -107,7 +107,7 @@
 #if defined(OS_WIN) || defined(OS_MACOSX) || defined(OS_BSD)
   explicit TransportDIB(base::SharedMemoryHandle dib);
   base::SharedMemory shared_memory_;
-#elif defined(OS_LINUX)
+#elif defined(OS_LINUX) || defined(OS_SOLARIS)
   int key_;  // SysV shared memory id
   void* address_;  // mapped address
   XID x_shm_;  // X id for the shared segment
diff -Nurb 000__VANILLA/mozilla-beta/ipc/chromium/src/third_party/libevent/arc4random.c 001__PORTED/mozilla-beta/ipc/chromium/src/third_party/libevent/arc4random.c
--- 000__VANILLA/mozilla-beta/ipc/chromium/src/third_party/libevent/arc4random.c	2015-03-06 04:30:37.000000000 +0100
+++ 001__PORTED/mozilla-beta/ipc/chromium/src/third_party/libevent/arc4random.c	2015-03-30 05:12:28.550218000 +0200
@@ -41,6 +41,8 @@
  * RC4 is a registered trademark of RSA Laboratories.
  */
 
+#include "build/build_config.h"
+
 #ifndef ARC4RANDOM_EXPORT
 #define ARC4RANDOM_EXPORT
 #endif
@@ -59,7 +59,7 @@
 #include <sys/param.h>
 #include <sys/time.h>
 #ifdef _EVENT_HAVE_SYS_SYSCTL_H
-#include <sys/sysctl.h>
+;//#include <sys/sysctl.h>
 #endif
 #endif
 #include <limits.h>
@@ -167,6 +169,10 @@
 }
 #endif
 
+#if defined (OS_SOLARIS)
+ #undef _EVENT_HAVE_SYS_SYSCTL_H
+#endif
+
 #if defined(_EVENT_HAVE_SYS_SYSCTL_H) && defined(_EVENT_HAVE_SYSCTL)
 #if _EVENT_HAVE_DECL_CTL_KERN && _EVENT_HAVE_DECL_KERN_RANDOM && _EVENT_HAVE_DECL_RANDOM_UUID
 #define TRY_SEED_SYSCTL_LINUX
diff -Nurb 000__VANILLA/mozilla-beta/ipc/chromium/src/third_party/libevent/event.c 001__PORTED/mozilla-beta/ipc/chromium/src/third_party/libevent/event.c
--- 000__VANILLA/mozilla-beta/ipc/chromium/src/third_party/libevent/event.c	2015-03-06 04:30:37.000000000 +0100
+++ 001__PORTED/mozilla-beta/ipc/chromium/src/third_party/libevent/event.c	2015-03-08 17:29:39.000000000 +0100
@@ -79,7 +79,7 @@
 extern const struct eventop pollops;
 #endif
 #ifdef _EVENT_HAVE_EPOLL
-extern const struct eventop epollops;
+//extern const struct eventop epollops;
 #endif
 #ifdef _EVENT_HAVE_WORKING_KQUEUE
 extern const struct eventop kqops;
@@ -100,7 +100,7 @@
 	&kqops,
 #endif
 #ifdef _EVENT_HAVE_EPOLL
-	&epollops,
+//	&epollops,
 #endif
 #ifdef _EVENT_HAVE_DEVPOLL
 	&devpollops,
@@ -2883,8 +2883,8 @@
 #endif
 	if (evsig_global_setup_locks_(enable_locks) < 0)
 		return -1;
-	if (evutil_secure_rng_global_setup_locks_(enable_locks) < 0)
-		return -1;
+//	if (evutil_secure_rng_global_setup_locks_(enable_locks) < 0)
+//		return -1;
 	return 0;
 }
 #endif
diff -Nurb 000__VANILLA/mozilla-beta/ipc/glue/BrowserProcessSubThread.cpp 001__PORTED/mozilla-beta/ipc/glue/BrowserProcessSubThread.cpp
--- 000__VANILLA/mozilla-beta/ipc/glue/BrowserProcessSubThread.cpp	2015-03-06 04:30:37.000000000 +0100
+++ 001__PORTED/mozilla-beta/ipc/glue/BrowserProcessSubThread.cpp	2015-03-25 08:48:15.836205000 +0100
@@ -25,9 +25,7 @@
 //  "Chrome_FileThread",  // FILE
 //  "Chrome_DBThread",  // DB
 //  "Chrome_HistoryThread",  // HISTORY
-#if defined(OS_LINUX)
   "Gecko_Background_X11Thread",  // BACKGROUND_X11
-#endif
 };
 
 Lock BrowserProcessSubThread::sLock;
@@ -36,9 +34,7 @@
 //  nullptr,  // FILE
 //  nullptr,  // DB
 //  nullptr,  // HISTORY
-#if defined(OS_LINUX)
   nullptr,  // BACKGROUND_X11
-#endif
 };
 
 BrowserProcessSubThread::BrowserProcessSubThread(ID aId) :
diff -Nurb 000__VANILLA/mozilla-beta/ipc/glue/BrowserProcessSubThread.h 001__PORTED/mozilla-beta/ipc/glue/BrowserProcessSubThread.h
--- 000__VANILLA/mozilla-beta/ipc/glue/BrowserProcessSubThread.h	2015-03-06 04:30:37.000000000 +0100
+++ 001__PORTED/mozilla-beta/ipc/glue/BrowserProcessSubThread.h	2015-03-25 08:46:01.302178000 +0100
@@ -28,12 +28,10 @@
       //FILE,
       //DB,
       //HISTORY,
-#if defined(OS_LINUX)
       // This thread has a second connection to the X server and is used
       // to process UI requests when routing the request to the UI
       // thread would risk deadlock.
       BACKGROUND_X11,
-#endif
 
       // This identifier does not represent a thread.  Instead it counts
       // the number of well-known threads.  Insert new well-known
diff -Nurb 000__VANILLA/mozilla-beta/ipc/glue/CrossProcessMutex_unimplemented.cpp 001__PORTED/mozilla-beta/ipc/glue/CrossProcessMutex_unimplemented.cpp
--- 000__VANILLA/mozilla-beta/ipc/glue/CrossProcessMutex_unimplemented.cpp	2015-03-06 04:30:37.000000000 +0100
+++ 001__PORTED/mozilla-beta/ipc/glue/CrossProcessMutex_unimplemented.cpp	2015-03-26 16:34:37.546496000 +0100
@@ -40,7 +40,6 @@
 CrossProcessMutex::ShareToProcess(base::ProcessHandle aHandle)
 {
   NS_RUNTIMEABORT("Cross-process mutices not allowed on this platform - woah! We should've aborted by now!");
-  return 0;
 }
 
 }
diff -Nurb 000__VANILLA/mozilla-beta/ipc/glue/GeckoChildProcessHost.cpp 001__PORTED/mozilla-beta/ipc/glue/GeckoChildProcessHost.cpp
--- 000__VANILLA/mozilla-beta/ipc/glue/GeckoChildProcessHost.cpp	2015-03-06 04:30:37.000000000 +0100
+++ 001__PORTED/mozilla-beta/ipc/glue/GeckoChildProcessHost.cpp	2015-03-27 14:24:03.787675000 +0100
@@ -4,7 +4,13 @@
  * License, v. 2.0. If a copy of the MPL was not distributed with this
  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */
 
-#include "GeckoChildProcessHost.h"
+#if defined(__sun__) || defined(__sun)
+_Pragma("GCC visibility push(default)")
+#endif
+ #include "GeckoChildProcessHost.h"
+#if defined(__sun__) || defined(__sun)
+_Pragma("GCC visibility pop")
+#endif
 
 #include "base/command_line.h"
 #include "base/string_util.h"
@@ -549,13 +555,16 @@
   // and passing wstrings from one config to the other is unsafe.  So
   // we split the logic here.
 
-#if defined(OS_LINUX) || defined(OS_MACOSX) || defined(OS_BSD)
-  base::environment_map newEnvVars;
+#if defined(OS_LINUX) || defined(OS_MACOSX) || defined(OS_BSD) || defined(OS_SOLARIS)
   ChildPrivileges privs = mPrivileges;
   if (privs == base::PRIVILEGES_DEFAULT) {
     privs = DefaultChildPrivileges();
   }
-  // XPCOM may not be initialized in some subprocesses.  We don't want
+#endif
+
+#if defined(OS_LINUX) || defined(OS_MACOSX) || defined(OS_BSD)
+  base::environment_map newEnvVars;
+// XPCOM may not be initialized in some subprocesses.  We don't want
   // to initialize XPCOM just for the directory service, especially
   // since LD_LIBRARY_PATH is already set correctly in subprocesses
   // (meaning that we don't need to set that up in the environment).
@@ -688,7 +697,7 @@
   childArgv.push_back(pidstring);
 
 #if defined(MOZ_CRASHREPORTER)
-#  if defined(OS_LINUX) || defined(OS_BSD)
+#  if defined(OS_LINUX) || defined(OS_BSD) || defined(OS_SOLARIS)
   int childCrashFd, childCrashRemapFd;
   if (!CrashReporter::CreateNotificationPipeForChild(
         &childCrashFd, &childCrashRemapFd))
@@ -704,7 +713,7 @@
   }
 #  elif defined(MOZ_WIDGET_COCOA)
   childArgv.push_back(CrashReporter::GetChildNotificationPipe());
-#  endif  // OS_LINUX
+#  endif  // OS_LINUX  || defined(OS_SOLARIS)
 #endif
 
 #ifdef MOZ_WIDGET_COCOA
@@ -723,6 +732,8 @@
   base::LaunchApp(childArgv, mFileMap,
 #if defined(OS_LINUX) || defined(OS_MACOSX) || defined(OS_BSD)
                   newEnvVars, privs,
+#elif defined(OS_SOLARIS)
+                  base::environment_map(), privs,
 #endif
                   false, &process, arch);
 
diff -Nurb 000__VANILLA/mozilla-beta/ipc/glue/MessageLink.cpp 001__PORTED/mozilla-beta/ipc/glue/MessageLink.cpp
--- 000__VANILLA/mozilla-beta/ipc/glue/MessageLink.cpp	2015-03-06 04:30:37.000000000 +0100
+++ 001__PORTED/mozilla-beta/ipc/glue/MessageLink.cpp	2015-03-09 11:22:40.000000000 +0100
@@ -22,6 +22,10 @@
 #include "nsISupportsImpl.h"
 #include "nsXULAppAPI.h"
 
+#if defined(__sun__) || defined(__sun)
+#include <unistd.h>
+#endif
+
 using namespace mozilla;
 using namespace std;
 
@@ -326,7 +330,7 @@
         mExistingListener = mTransport->set_listener(this);
 #ifdef DEBUG
         if (mExistingListener) {
-            queue<Message> pending;
+            std::queue<Message> pending;
             mExistingListener->GetQueuedMessages(pending);
             MOZ_ASSERT(pending.empty());
         }
@@ -343,7 +347,7 @@
 {
     AssertIOThread();
 
-    queue<Message> pending;
+    std::queue<Message> pending;
     {
         MonitorAutoLock lock(*mChan->mMonitor);
 
diff -Nurb 000__VANILLA/mozilla-beta/js/src/gc/Memory.cpp 001__PORTED/mozilla-beta/js/src/gc/Memory.cpp
--- 000__VANILLA/mozilla-beta/js/src/gc/Memory.cpp	2015-03-06 04:30:38.000000000 +0100
+++ 001__PORTED/mozilla-beta/js/src/gc/Memory.cpp	2015-03-09 22:50:52.000000000 +0100
@@ -86,7 +89,7 @@
 void *
 TestMapAlignedPagesLastDitch(size_t size, size_t alignment)
 {
-    return MapAlignedPagesLastDitch(size, alignment);
+    ; //return MapAlignedPagesLastDitch(size, alignment);
 }
 
 
@@ -604,7 +607,7 @@
         return false;
 
     MOZ_ASSERT(OffsetFromAligned(p, pageSize) == 0);
-    int result = madvise(p, size, MADV_DONTNEED);
+    int result = posix_madvise(p, size, MADV_DONTNEED);
     return result != -1;
 }
 
diff -Nurb 000__VANILLA/mozilla-beta/js/src/jsobj.cpp 001__PORTED/mozilla-beta/js/src/jsobj.cpp
--- 000__VANILLA/mozilla-beta/js/src/jsobj.cpp	2015-03-06 04:30:41.000000000 +0100
+++ 001__PORTED/mozilla-beta/js/src/jsobj.cpp	2015-03-09 01:46:20.000000000 +0100
@@ -1521,6 +1521,7 @@
  * Create a plain object with the specified type. This bypasses getNewType to
  * avoid losing creation site information for objects made by scripted 'new'.
  */
+#pragma weak "__1cCjsRNewObjectWithType6FpnJJSContext_nCJSGHandle4Cpn0AFtypesKTypeObject___pnIJSObject_n0ACgcJAllocKind_n0ANNewObjectKind__9A" = "__1cCjsRNewObjectWithType6FpnJJSContext_nCJSGHandle4Cpn0AFtypesKTypeObject___pnIJSObject_n0ACgcJAllocKind_n0ANNewObjectKind__9A_"
 JSObject *
 js::NewObjectWithTypeCommon(JSContext *cx, HandleTypeObject type, JSObject *parent, gc::AllocKind allocKind,
                             NewObjectKind newKind)
diff -Nurb 000__VANILLA/mozilla-beta/media/libcubeb/src/cubeb.c 001__PORTED/mozilla-beta/media/libcubeb/src/cubeb.c
--- 000__VANILLA/mozilla-beta/media/libcubeb/src/cubeb.c	2015-03-06 04:30:37.000000000 +0100
+++ 001__PORTED/mozilla-beta/media/libcubeb/src/cubeb.c	2015-03-10 15:35:39.000000000 +0100
@@ -56,6 +56,9 @@
 #if defined(USE_AUDIOTRACK)
 int audiotrack_init(cubeb ** context, char const * context_name);
 #endif
+#if defined(USE_SUN)
+int sunaudio_init(cubeb ** context, char const * context_name);
+#endif
 
 int
 validate_stream_params(cubeb_stream_params stream_params)
@@ -122,6 +125,9 @@
 #if defined(USE_AUDIOTRACK)
     audiotrack_init,
 #endif
+#if defined(USE_SUN)
+    sunaudio_init,
+#endif
   };
   int i;
 
diff -Nurb 000__VANILLA/mozilla-beta/media/libcubeb/src/cubeb_sun.c 001__PORTED/mozilla-beta/media/libcubeb/src/cubeb_sun.c
--- 000__VANILLA/mozilla-beta/media/libcubeb/src/cubeb_sun.c	1970-01-01 01:00:00.000000000 +0100
+++ 001__PORTED/mozilla-beta/media/libcubeb/src/cubeb_sun.c	2015-03-10 15:31:40.000000000 +0100
@@ -0,0 +1,435 @@
+/*
+ * Copyright (c) 2013 Ginn Chen <ginnchen@gmail.com>
+ *
+ * This program is made available under an ISC-style license.  See the
+ * accompanying file LICENSE for details.
+ */
+#include <poll.h>
+#include <pthread.h>
+#include <stdlib.h>
+#include <stdio.h>
+#include <errno.h>
+#include <fcntl.h>
+#include <sys/audio.h>
+#include <sys/stat.h>
+#include <unistd.h>
+#include <sys/stropts.h>
+#include "cubeb/cubeb.h"
+#include "cubeb-internal.h"
+
+/* Macros copied from audio_oss.h */
+/*
+ * CDDL HEADER START
+ *
+ * The contents of this file are subject to the terms of the
+ * Common Development and Distribution License (the "License").
+ * You may not use this file except in compliance with the License.
+ *
+ * You can obtain a copy of the license at usr/src/OPENSOLARIS.LICENSE
+ * or http://www.opensolaris.org/os/licensing.
+ * See the License for the specific language governing permissions
+ * and limitations under the License.
+ *
+ * When distributing Covered Code, include this CDDL HEADER in each
+ * file and include the License file at usr/src/OPENSOLARIS.LICENSE.
+ * If applicable, add the following below this CDDL HEADER, with the
+ * fields enclosed by brackets "[]" replaced with your own identifying
+ * information: Portions Copyright [yyyy] [name of copyright owner]
+ *
+ * CDDL HEADER END
+ */
+/*
+ * Copyright (C) 4Front Technologies 1996-2008.
+ *
+ * Copyright 2009 Sun Microsystems, Inc.  All rights reserved.
+ * Use is subject to license terms.
+ */
+#define OSSIOCPARM_MASK 0x1fff          /* parameters must be < 8192 bytes */
+#define OSSIOC_VOID     0x00000000      /* no parameters */
+#define OSSIOC_OUT      0x20000000      /* copy out parameters */
+#define OSSIOC_IN       0x40000000      /* copy in parameters */
+#define OSSIOC_INOUT    (OSSIOC_IN|OSSIOC_OUT)
+#define OSSIOC_SZ(t)    ((sizeof (t) & OSSIOCPARM_MASK) << 16)
+#define __OSSIO(x, y)           ((int)(OSSIOC_VOID|(x<<8)|y))
+#define __OSSIOR(x, y, t)       ((int)(OSSIOC_OUT|OSSIOC_SZ(t)|(x<<8)|y))
+#define __OSSIOWR(x, y, t)      ((int)(OSSIOC_INOUT|OSSIOC_SZ(t)|(x<<8)|y))
+#define SNDCTL_DSP_SPEED        __OSSIOWR('P', 2, int)
+#define SNDCTL_DSP_CHANNELS     __OSSIOWR('P', 6, int)
+#define SNDCTL_DSP_SETFMT       __OSSIOWR('P', 5, int)  /* Selects ONE fmt */
+#define SNDCTL_DSP_GETODELAY    __OSSIOR('P', 23, int)
+#define SNDCTL_DSP_HALT_OUTPUT  __OSSIO('P', 34)
+#define AFMT_S16_LE     0x00000010
+#define AFMT_S16_BE     0x00000020
+
+#if defined(WORDS_BIGENDIAN) || defined(__BIG_ENDIAN__)
+#define AFMT_S16_NE    AFMT_S16_BE
+#else
+#define AFMT_S16_NE    AFMT_S16_LE
+#endif
+
+#define DEFAULT_AUDIO_DEVICE "/dev/audio"
+#define DEFAULT_DSP_DEVICE   "/dev/dsp"
+
+#define BUF_SIZE_MS 10
+
+#if defined(CUBEB_SUNAUDIO_DEBUG)
+#define DPR(...) fprintf(stderr, __VA_ARGS__);
+#else
+#define DPR(...) do {} while(0)
+#endif
+
+static struct cubeb_ops const sunaudio_ops;
+
+struct cubeb {
+  struct cubeb_ops const * ops;
+};
+
+struct cubeb_stream {
+  cubeb * context;
+  pthread_t th;			  /* to run real-time audio i/o */
+  pthread_mutex_t mutex;	  /* protects fd and frm_played */
+  int fd;			  /* link us to sunaudio */
+  int active;			  /* cubec_start() called */
+  int conv;			  /* need float->s16 conversion */
+  int using_oss;
+  unsigned char *buf;		  /* data is prepared here */
+  unsigned int rate;
+  unsigned int n_channles;
+  unsigned int bytes_per_ch;
+  unsigned int n_frm;
+  unsigned int buffer_size;
+  int64_t frm_played;
+  cubeb_data_callback data_cb;    /* cb to preapare data */
+  cubeb_state_callback state_cb;  /* cb to notify about state changes */
+  void *arg;			  /* user arg to {data,state}_cb */
+};
+
+static void
+float_to_s16(void *ptr, long nsamp)
+{
+  int16_t *dst = ptr;
+  float *src = ptr;
+
+  while (nsamp-- > 0)
+    *(dst++) = *(src++) * 32767;
+}
+
+static void *
+sunaudio_mainloop(void *arg)
+{
+  struct cubeb_stream *s = arg;
+  int state;
+
+  DPR("sunaudio_mainloop()\n");
+
+  s->state_cb(s, s->arg, CUBEB_STATE_STARTED);
+
+  pthread_mutex_lock(&s->mutex);
+  DPR("sunaudio_mainloop(), started\n");
+
+  for (;;) {
+    if (!s->active) {
+      DPR("sunaudio_mainloop() stopped\n");
+      state = CUBEB_STATE_STOPPED;
+      break;
+    }
+
+    if (!s->using_oss) {
+      audio_info_t info;
+      ioctl(s->fd, AUDIO_GETINFO, &info);
+      if (s->frm_played > info.play.samples + 3 * s->n_frm) {
+        pthread_mutex_unlock(&s->mutex);
+        struct timespec ts = {0, 10000}; // 10 ms
+        nanosleep(&ts, NULL);
+        pthread_mutex_lock(&s->mutex);
+        continue;
+      }
+    }
+
+    pthread_mutex_unlock(&s->mutex);
+    unsigned int got = s->data_cb(s, s->arg, s->buf, s->n_frm);
+    DPR("sunaudio_mainloop() ask %d got %d\n", s->n_frm, got);
+    pthread_mutex_lock(&s->mutex);
+
+    if (got < 0) {
+      DPR("sunaudio_mainloop() cb err\n");
+      state = CUBEB_STATE_ERROR;
+      break;
+    }
+
+    if (s->conv) {
+      float_to_s16(s->buf, got * s->n_channles);
+    }
+
+    unsigned int avail = got * 2 * s->n_channles; // coverted to s16
+    unsigned int pos = 0;
+
+    while (avail > 0 && s->active) {
+      int written = write(s->fd, s->buf + pos, avail);
+      if (written == -1) {
+        if (errno != EINTR && errno != EWOULDBLOCK) {
+          DPR("sunaudio_mainloop() write err\n");
+          state = CUBEB_STATE_ERROR;
+          break;
+        }
+        pthread_mutex_unlock(&s->mutex);
+        struct timespec ts = {0, 10000}; // 10 ms
+        nanosleep(&ts, NULL);
+        pthread_mutex_lock(&s->mutex);
+      } else {
+        pos += written;
+        DPR("sunaudio_mainloop() write %d pos %d\n", written, pos);
+        s->frm_played += written / 2 / s->n_channles;
+        avail -= written;
+      }
+    }
+
+    if ((got  < s->n_frm)) {
+      DPR("sunaudio_mainloop() drained\n");
+      state = CUBEB_STATE_DRAINED;
+      break;
+    }
+  }
+
+  pthread_mutex_unlock(&s->mutex);
+  s->state_cb(s, s->arg, state);
+
+  return NULL;
+}
+
+/*static*/ int
+sunaudio_init(cubeb **context, char const *context_name)
+{
+  DPR("sunaudio_init(%s)\n", context_name);
+  *context = malloc(sizeof(*context));
+  (*context)->ops = &sunaudio_ops;
+  (void)context_name;
+  return CUBEB_OK;
+}
+
+static char const *
+sunaudio_get_backend_id(cubeb *context)
+{
+  return "sunaudio";
+}
+
+static void
+sunaudio_destroy(cubeb *context)
+{
+  DPR("sunaudio_destroy()\n");
+  free(context);
+}
+
+static int
+sunaudio_stream_init(cubeb *context,
+                  cubeb_stream **stream,
+                  char const *stream_name,
+                  cubeb_stream_params stream_params, unsigned int latency,
+                  cubeb_data_callback data_callback,
+                  cubeb_state_callback state_callback,
+                  void *user_ptr)
+{
+  struct cubeb_stream *s;
+  DPR("sunaudio_stream_init(%s)\n", stream_name);
+  size_t size;
+
+  s = malloc(sizeof(struct cubeb_stream));
+  if (s == NULL)
+    return CUBEB_ERROR;
+  s->context = context;
+
+  // If UTAUDIODEV is set, use it with Sun Audio interface
+  char * sa_device_name = getenv("UTAUDIODEV");
+  char * dsp_device_name = NULL;
+  if (!sa_device_name) {
+    dsp_device_name = getenv("AUDIODSP");
+    if (!dsp_device_name) {
+      dsp_device_name = DEFAULT_DSP_DEVICE;
+    }
+    sa_device_name = getenv("AUDIODEV");
+    if (!sa_device_name) {
+      sa_device_name = DEFAULT_AUDIO_DEVICE;
+    }
+  }
+
+  s->using_oss = 0;
+  // Try to use OSS if available
+  if (dsp_device_name) {
+    s->fd = open(dsp_device_name, O_WRONLY | O_NONBLOCK);
+    if (s->fd >= 0) {
+      s->using_oss = 1;
+    }
+  }
+
+  // Try Sun Audio
+  if (!s->using_oss) {
+    s->fd = open(sa_device_name, O_WRONLY | O_NONBLOCK);
+  }
+
+  if (s->fd < 0) {
+    free(s);
+    DPR("sunaudio_stream_init(), open() failed\n");
+    return CUBEB_ERROR;
+  }
+
+  if (s->using_oss) {
+    if (ioctl(s->fd, SNDCTL_DSP_SPEED, &stream_params.rate) < 0) {
+      DPR("ioctl SNDCTL_DSP_SPEED failed.\n");
+      close(s->fd);
+      free(s);
+      return CUBEB_ERROR_INVALID_FORMAT;
+    }
+
+    if (ioctl(s->fd, SNDCTL_DSP_CHANNELS, &stream_params.channels) < 0) {
+      DPR("ioctl SNDCTL_DSP_CHANNELS failed.\n");
+      close(s->fd);
+      free(s);
+      return CUBEB_ERROR_INVALID_FORMAT;
+    }
+
+    int format = AFMT_S16_NE;
+    if (ioctl(s->fd, SNDCTL_DSP_SETFMT, &format) < 0) {
+      DPR("ioctl SNDCTL_DSP_SETFMT failed.\n");
+      close(s->fd);
+      free(s);
+      return CUBEB_ERROR_INVALID_FORMAT;
+    }
+  } else {
+    audio_info_t audio_info;
+    AUDIO_INITINFO(&audio_info)
+    audio_info.play.sample_rate = stream_params.rate;
+    audio_info.play.channels = stream_params.channels;
+    audio_info.play.encoding = AUDIO_ENCODING_LINEAR;
+    audio_info.play.precision = 16;
+    if (ioctl(s->fd, AUDIO_SETINFO, &audio_info) == -1) {
+      DPR("ioctl AUDIO_SETINFO failed.\n");
+      close(s->fd);
+      free(s);
+      return CUBEB_ERROR_INVALID_FORMAT;
+    }
+  }
+
+  s->conv = 0;
+  switch (stream_params.format) {
+    case CUBEB_SAMPLE_S16NE:
+      s->bytes_per_ch = 2;
+      break;
+    case CUBEB_SAMPLE_FLOAT32NE:
+      s->bytes_per_ch = 4;
+      s->conv = 1;
+      break;
+    default:
+      DPR("sunaudio_stream_init() unsupported format\n");
+      close(s->fd);
+      free(s);
+      return CUBEB_ERROR_INVALID_FORMAT;
+  }
+
+  s->active = 0;
+  s->rate = stream_params.rate;
+  s->n_channles = stream_params.channels;
+  s->data_cb = data_callback;
+  s->state_cb = state_callback;
+  s->arg = user_ptr;
+  if (pthread_mutex_init(&s->mutex, NULL) != 0) {
+    free(s);
+    return CUBEB_ERROR;
+  }
+  s->frm_played = 0;
+  s->n_frm = s->rate * BUF_SIZE_MS / 1000;
+  s->buffer_size = s->bytes_per_ch * s->n_channles * s->n_frm;
+  s->buf = malloc(s->buffer_size);
+  if (s->buf == NULL) {
+    close(s->fd);
+    free(s);
+    return CUBEB_ERROR;
+  }
+
+  *stream = s;
+  DPR("sunaudio_stream_init() end, ok\n");
+  return CUBEB_OK;
+}
+
+static void
+sunaudio_stream_destroy(cubeb_stream *s)
+{
+  DPR("sunaudio_stream_destroy()\n");
+  if (s->fd > 0) {
+    // Flush buffer
+    if (s->using_oss) {
+      ioctl(s->fd, SNDCTL_DSP_HALT_OUTPUT);
+    } else {
+      ioctl(s->fd, I_FLUSH);
+    }
+    close(s->fd);
+  }
+  free(s->buf);
+  free(s);
+}
+
+static int
+sunaudio_stream_start(cubeb_stream *s)
+{
+  int err;
+
+  DPR("sunaudio_stream_start()\n");
+  s->active = 1;
+  err = pthread_create(&s->th, NULL, sunaudio_mainloop, s);
+  if (err) {
+    s->active = 0;
+    return CUBEB_ERROR;
+  }
+  return CUBEB_OK;
+}
+
+static int
+sunaudio_stream_stop(cubeb_stream *s)
+{
+  void *dummy;
+
+  DPR("sunaudio_stream_stop()\n");
+  if (s->active) {
+    s->active = 0;
+    pthread_join(s->th, &dummy);
+  }
+  return CUBEB_OK;
+}
+
+static int
+sunaudio_stream_get_position(cubeb_stream *s, uint64_t *p)
+{
+  int rv = CUBEB_OK;
+  pthread_mutex_lock(&s->mutex);
+  if (s->active && s->fd > 0) {
+    if (s->using_oss) {
+      int delay;
+      ioctl(s->fd, SNDCTL_DSP_GETODELAY, &delay);
+      int64_t t = s->frm_played - delay / s->n_channles / 2;
+      if (t < 0) {
+        *p = 0;
+      } else {
+        *p = t;
+      }
+    } else {
+      audio_info_t info;
+      ioctl(s->fd, AUDIO_GETINFO, &info);
+      *p = info.play.samples;
+    }
+    DPR("sunaudio_stream_get_position() %lld\n", *p);
+  } else {
+    rv = CUBEB_ERROR;
+  }
+  pthread_mutex_unlock(&s->mutex);
+  return rv;
+}
+
+static struct cubeb_ops const sunaudio_ops = {
+  .init = sunaudio_init,
+  .get_backend_id = sunaudio_get_backend_id,
+  .destroy = sunaudio_destroy,
+  .stream_init = sunaudio_stream_init,
+  .stream_destroy = sunaudio_stream_destroy,
+  .stream_start = sunaudio_stream_start,
+  .stream_stop = sunaudio_stream_stop,
+  .stream_get_position = sunaudio_stream_get_position
+};
diff -Nurb 000__VANILLA/mozilla-beta/media/libsoundtouch/src/FIRFilter.cpp 001__PORTED/mozilla-beta/media/libsoundtouch/src/FIRFilter.cpp
--- 000__VANILLA/mozilla-beta/media/libsoundtouch/src/FIRFilter.cpp	2015-03-06 04:30:38.000000000 +0100
+++ 001__PORTED/mozilla-beta/media/libsoundtouch/src/FIRFilter.cpp	2015-03-07 07:06:11.000000000 +0100
@@ -49,6 +49,8 @@
 #ifdef _MSC_VER
 #include <malloc.h>
 #define alloca _alloca
+#elif defined(__sun__) || defined(__sun)
+#include <alloca.h>
 #endif
 
 using namespace soundtouch;
diff -Nurb 000__VANILLA/mozilla-beta/media/libvpx/vpx_ports/x86_abi_support.asm 001__PORTED/mozilla-beta/media/libvpx/vpx_ports/x86_abi_support.asm
--- 000__VANILLA/mozilla-beta/media/libvpx/vpx_ports/x86_abi_support.asm	2015-03-06 04:30:38.000000000 +0100
+++ 001__PORTED/mozilla-beta/media/libvpx/vpx_ports/x86_abi_support.asm	2015-03-07 08:33:49.000000000 +0100
@@ -231,6 +231,11 @@
   %else
     %define HIDDEN_DATA(x) x
   %endif
+  %ifidn SOLARIS,1
+    %define HIDDEN_DATA(x) x:data hidden
+  %else
+  %define HIDDEN_DATA(x) x
+ %endif
 %else
   %macro GET_GOT 1
   %endmacro
diff -Nurb 000__VANILLA/mozilla-beta/memory/mozalloc/mozalloc.cpp 001__PORTED/mozilla-beta/memory/mozalloc/mozalloc.cpp
--- 000__VANILLA/mozilla-beta/memory/mozalloc/mozalloc.cpp	2015-03-06 04:30:41.000000000 +0100
+++ 001__PORTED/mozilla-beta/memory/mozalloc/mozalloc.cpp	2015-03-07 01:55:41.000000000 +0100
@@ -200,6 +200,14 @@
 }
 #endif // if defined(HAVE_VALLOC)
 
+//#if defined(MOZ_MEMORY_SOLARIS)
+#include "jemalloc_types.h"
+extern "C" {
+extern size_t malloc_usable_size(const void *ptr);
+extern void jemalloc_stats(jemalloc_stats_t* stats);
+}
+//#endif
+
 size_t
 moz_malloc_usable_size(void *ptr)
 {
@@ -209,7 +217,22 @@
 #if defined(XP_MACOSX)
     return malloc_size(ptr);
 #elif defined(HAVE_MALLOC_USABLE_SIZE) || defined(MOZ_MEMORY)
+//#if defined(SOLARIS)
+    static bool checked = false;
+    static bool using_jemalloc = false;
+    if (!checked) {
+        checked = true;
+        jemalloc_stats_t stats;
+        jemalloc_stats(&stats);
+        using_jemalloc = stats.allocated;
+    }
+    if (using_jemalloc)
     return malloc_usable_size(ptr);
+    else
+        return 0;
+//#else
+//    return malloc_usable_size(ptr);
+//#endif
 #elif defined(XP_WIN)
     return _msize(ptr);
 #else
diff -Nurb 000__VANILLA/mozilla-beta/memory/mozalloc/mozalloc_abort.cpp 001__PORTED/mozilla-beta/memory/mozalloc/mozalloc_abort.cpp
--- 000__VANILLA/mozilla-beta/memory/mozalloc/mozalloc_abort.cpp	2015-03-06 04:30:41.000000000 +0100
+++ 001__PORTED/mozilla-beta/memory/mozalloc/mozalloc_abort.cpp	2015-03-07 01:59:37.000000000 +0100
@@ -63,7 +63,7 @@
 // Define abort() here, so that it is used instead of the system abort(). This
 // lets us control the behavior when aborting, in order to get better results
 // on *NIX platforms. See mozalloc_abort for details.
-void abort(void)
+void std::abort(void)
 {
 #ifdef MOZ_WIDGET_ANDROID
     char msg[64] = {};
diff -Nurb 000__VANILLA/mozilla-beta/mfbt/Poison.cpp 001__PORTED/mozilla-beta/mfbt/Poison.cpp
--- 000__VANILLA/mozilla-beta/mfbt/Poison.cpp	2015-03-06 04:30:41.000000000 +0100
+++ 001__PORTED/mozilla-beta/mfbt/Poison.cpp	2015-03-08 19:34:53.000000000 +0100
@@ -129,7 +129,11 @@
 static bool
 ProbeRegion(uintptr_t aRegion, uintptr_t aSize)
 {
+#if !defined(__sun__)
   if (madvise(reinterpret_cast<void*>(aRegion), aSize, MADV_NORMAL)) {
+#else
+  if (posix_madvise(reinterpret_cast<void*>(aRegion), aSize, MADV_NORMAL)) {
+#endif
     return true;
   } else {
     return false;
diff -Nurb 000__VANILLA/mozilla-beta/mfbt/decimal/Decimal.cpp 001__PORTED/mozilla-beta/mfbt/decimal/Decimal.cpp
--- 000__VANILLA/mozilla-beta/mfbt/decimal/Decimal.cpp	2015-03-06 04:30:41.000000000 +0100
+++ 001__PORTED/mozilla-beta/mfbt/decimal/Decimal.cpp	2015-03-08 18:21:15.000000000 +0100
@@ -33,6 +33,7 @@
 
 #include <algorithm>
 #include <float.h>
+#include <ieeefp.h>
 
 using namespace moz_decimal_utils;
 
@@ -686,13 +687,13 @@
 
 Decimal Decimal::fromDouble(double doubleValue)
 {
-    if (std::isfinite(doubleValue))
-        return fromString(mozToString(doubleValue));
+    if (isnand(doubleValue))
+        return nan();
 
-    if (std::isinf(doubleValue))
-        return infinity(doubleValue < 0 ? Negative : Positive);
+    if (finite(doubleValue))
+return fromString(mozToString(doubleValue));
 
-    return nan();
+        return infinity(doubleValue < 0 ? Negative : Positive);
 }
 
 Decimal Decimal::fromString(const String& str)
diff -Nurb 000__VANILLA/mozilla-beta/mfbt/lz4.c 001__PORTED/mozilla-beta/mfbt/lz4.c
--- 000__VANILLA/mozilla-beta/mfbt/lz4.c	2015-03-06 04:30:41.000000000 +0100
+++ 001__PORTED/mozilla-beta/mfbt/lz4.c	2015-03-08 18:15:55.000000000 +0100
@@ -877,7 +877,7 @@
                  )
 {
     /* Local Variables */
-    const BYTE* restrict ip = (const BYTE*) source;
+    const BYTE* ip = (const BYTE*) source;
     const BYTE* ref;
     const BYTE* const iend = ip + inputSize;
 
diff -Nurb 000__VANILLA/mozilla-beta/modules/libjar/nsZipArchive.cpp 001__PORTED/mozilla-beta/modules/libjar/nsZipArchive.cpp
--- 000__VANILLA/mozilla-beta/modules/libjar/nsZipArchive.cpp	2015-03-06 04:30:43.000000000 +0100
+++ 001__PORTED/mozilla-beta/modules/libjar/nsZipArchive.cpp	2015-03-27 14:22:42.682574000 +0100
@@ -40,6 +40,7 @@
     #include <sys/stat.h>
     #include <limits.h>
     #include <unistd.h>
+extern "C" int madvise(caddr_t, size_t, int);
 #elif defined(XP_WIN)
     #include <io.h>
 #endif
@@ -611,8 +612,10 @@
     // Success means optimized jar layout from bug 559961 is in effect
     uint32_t readaheadLength = xtolong(startp);
     if (readaheadLength) {
-#if defined(XP_UNIX)
-      madvise(const_cast<uint8_t*>(startp), readaheadLength, MADV_WILLNEED);
+#if defined(OS_SOLARIS)
+      posix_madvise((caddr_t)const_cast<uint8_t*>(startp), readaheadLength, MADV_WILLNEED);
+#elif defined(XP_UNIX)
+      madvise((caddr_t)const_cast<uint8_t*>(startp), readaheadLength, MADV_WILLNEED);
 #elif defined(XP_WIN)
       if (aFd) {
         HANDLE hFile = (HANDLE) PR_FileDesc2NativeHandle(aFd);
diff -Nurb 000__VANILLA/mozilla-beta/toolkit/library/libxul.mk 001__PORTED/mozilla-beta/toolkit/library/libxul.mk
--- 000__VANILLA/mozilla-beta/toolkit/library/libxul.mk	2015-03-06 04:30:45.000000000 +0100
+++ 001__PORTED/mozilla-beta/toolkit/library/libxul.mk	2015-03-22 02:30:54.207470000 +0100
@@ -51,15 +51,3 @@
 endif
 endif
 endif
-
-ifdef _MSC_VER
-get_first_and_last = dumpbin -exports $1 | grep _NSModule@@ | sort -k 3 | sed -n 's/^.*?\([^@]*\)@@.*$$/\1/;1p;$$p'
-else
-get_first_and_last = $(TOOLCHAIN_PREFIX)nm -g $1 | grep _NSModule$$ | grep -vw refptr | sort | sed -n 's/^.* _*\([^ ]*\)$$/\1/;1p;$$p'
-endif
-
-LOCAL_CHECKS = test "$$($(get_first_and_last) | xargs echo)" != "start_kPStaticModules_NSModule end_kPStaticModules_NSModule" && echo "NSModules are not ordered appropriately" && exit 1 || exit 0
-
-ifeq (Linux,$(OS_ARCH))
-LOCAL_CHECKS += ; test "$$($(TOOLCHAIN_PREFIX)readelf -l $1 | awk '$1 == "LOAD" { t += 1 } END { print t }')" -le 1 && echo "Only one PT_LOAD segment" && exit 1 || exit 0
-endif
diff -Nurb 000__VANILLA/mozilla-beta/toolkit/mozapps/update/updater/updater.cpp 001__PORTED/mozilla-beta/toolkit/mozapps/update/updater/updater.cpp
--- 000__VANILLA/mozilla-beta/toolkit/mozapps/update/updater/updater.cpp	2015-03-06 04:30:46.000000000 +0100
+++ 001__PORTED/mozilla-beta/toolkit/mozapps/update/updater/updater.cpp	2015-03-22 18:22:55.944385000 +0100
@@ -33,6 +33,9 @@
  *  -----------
  *  method   = "remove" | "rmdir"
  */
+
+#define SOLARIS 1
+
 #include "bspatch.h"
 #include "progressui.h"
 #include "archivereader.h"
diff -Nurb 000__VANILLA/mozilla-beta/widget/GfxInfoX11.cpp 001__PORTED/mozilla-beta/widget/GfxInfoX11.cpp
--- 000__VANILLA/mozilla-beta/widget/GfxInfoX11.cpp	2015-03-06 04:30:47.000000000 +0100
+++ 001__PORTED/mozilla-beta/widget/GfxInfoX11.cpp	2015-03-21 10:58:58.318300000 +0100
@@ -210,13 +210,13 @@
         // with Mesa, the version string contains "Mesa major.minor" and that's all the version information we get:
         // there is no actual driver version info.
         whereToReadVersionNumbers = Mesa_in_version_string + strlen("Mesa");
-        if (strcasestr(mVendor.get(), "nouveau"))
+        if (PL_strcasestr(mVendor.get(), "nouveau"))
             mIsNouveau = true;
-        if (strcasestr(mRenderer.get(), "intel")) // yes, intel is in the renderer string
+        if (PL_strcasestr(mRenderer.get(), "intel")) // yes, intel is in the renderer string
             mIsIntel = true;
-        if (strcasestr(mRenderer.get(), "llvmpipe"))
+        if (PL_strcasestr(mRenderer.get(), "llvmpipe"))
             mIsLlvmpipe = true;
-        if (strcasestr(mRenderer.get(), "software rasterizer"))
+        if (PL_strcasestr(mRenderer.get(), "software rasterizer"))
             mIsOldSwrast = true;
     } else if (strstr(mVendor.get(), "NVIDIA Corporation")) {
         mIsNVIDIA = true;
diff -Nurb 000__VANILLA/mozilla-beta/x05CONFIGURE__NONDEBUG.sh 001__PORTED/mozilla-beta/x05CONFIGURE__NONDEBUG.sh
--- 000__VANILLA/mozilla-beta/x05CONFIGURE__NONDEBUG.sh	1970-01-01 01:00:00.000000000 +0100
+++ 001__PORTED/mozilla-beta/x05CONFIGURE__NONDEBUG.sh	2015-03-23 02:27:20.214215000 +0100
@@ -0,0 +1,2 @@
+bash ../configure --enable-application=browser --prefix=/usr/lib/firefox37  --enable-official-branding --disable-updater --enable-debug-symbols=no --enable-update-channel=esr --disable-tests --enable-jemalloc --disable-dtrace --disable-xinerama --disable-crashreporter --disable-pulseaudio --disable-gstreamer --without-intl-api --disable-debug --enable-ipc
+
diff -Nurb 000__VANILLA/mozilla-beta/xpcom/base/nsStatusReporterManager.cpp 001__PORTED/mozilla-beta/xpcom/base/nsStatusReporterManager.cpp
--- 000__VANILLA/mozilla-beta/xpcom/base/nsStatusReporterManager.cpp	2015-03-06 04:30:47.000000000 +0100
+++ 001__PORTED/mozilla-beta/xpcom/base/nsStatusReporterManager.cpp	2015-03-07 06:28:21.000000000 +0100
@@ -146,9 +146,11 @@
 {
   static unsigned number = 1;
   nsresult rv;
+  int thispid = 181818;
 
+  thispid = getpid();
   nsCString filename("status-reports-");
-  filename.AppendInt(getpid());
+  filename.AppendInt(thispid);
   filename.Append('-');
   filename.AppendInt(number++);
   filename.AppendLiteral(".json");
--- 000__VANILLA/mozilla-beta/config/system-headers	2015-03-06 04:30:38.000000000 +0100
+++ 001__PORTED/mozilla-beta/config/system-headers	2015-11-07 00:59:45.714492770 +0100
@@ -1072,7 +1072,6 @@
 sys/stat.h
 sys/statvfs.h
 sys/syscall.h
-sys/sysctl.h
 sys/sysinfo.h
 sys/sysmp.h
 sys/syssgi.h
--- 000__VANILLA/mozilla-beta/browser/installer/package-manifest.in	2015-03-06 04:30:37.000000000 +0100
+++ 001__PORTED/mozilla-beta/browser/installer/package-manifest.in	2015-11-07 01:34:24.494716546 +0100
@@ -786,13 +786,6 @@
 #endif
 #endif
 
-; for Solaris SPARC
-#ifdef SOLARIS
-bin/libfreebl_32fpu_3.so
-bin/libfreebl_32int_3.so
-bin/libfreebl_32int64_3.so
-#endif
-
 ; [Updater]
 ;
 #ifdef MOZ_UPDATER
--- 000__VANILLA/mozilla-beta/ipc/chromium/moz.build	2015-03-06 04:30:37.000000000 +0100
+++ 001__PORTED/mozilla-beta/ipc/chromium/moz.build	2015-11-07 02:04:12.877762470 +0100
@@ -13,6 +13,7 @@
 os_openbsd = 0
 os_bsd = 0
 os_linux = 0
+os_solaris = 0
 
 if CONFIG['OS_ARCH'] == 'WINNT':
     os_win = 1
@@ -32,6 +33,8 @@
     elif CONFIG['OS_ARCH'] == 'OpenBSD':
         os_openbsd = 1
         os_bsd = 1
+    elif CONFIG['OS_ARCH'] == 'SunOS':
+	os_solaris = 1
     else:
         os_linux = 1
 
@@ -246,6 +249,23 @@
         ]
         LOCAL_INCLUDES += ['src/third_party/libevent/bsd']
 
+if os_solaris:
+    SOURCES += [
+	'src/base/atomicops_internals_x86_gcc.cc',
+	'src/base/idle_timer_none.cc',
+	'src/base/process_util_linux.cc',
+	'src/base/time_posix.cc',
+    ]
+    if CONFIG['MOZ_WIDGET_GTK']:
+	SOURCES += [
+            'src/base/message_pump_glib.cc',
+	]
+    if not CONFIG['MOZ_NATIVE_LIBEVENT']:
+	SOURCES += [
+            'src/third_party/libevent/devpoll.c',
+	]
+    LOCAL_INCLUDES += ['src/third_party/libevent/linux']
+
 ost = CONFIG['OS_TEST']
 if ost.find('86') == -1 and ost.find('arm') == -1 and ost.find('mips') == -1:
     SOURCES += [
--- 000__VANILLA/mozilla-beta/media/libcubeb/src/moz.build	2015-03-06 04:30:37.000000000 +0100
+++ 001__PORTED/mozilla-beta/media/libcubeb/src/moz.build	2015-11-07 02:14:37.291003038 +0100
@@ -38,6 +38,12 @@
     ]
     DEFINES['USE_AUDIOUNIT'] = True
 
+if CONFIG['OS_ARCH'] == 'SunOS':
+    SOURCES += [
+	'cubeb_sun.c',
+    ]
+    DEFINES['USE_SUN'] = True
+
 if CONFIG['OS_TARGET'] == 'WINNT':
     SOURCES += [
         'cubeb_resampler.cpp',
--- 000__VANILLA/mozilla-beta/toolkit/library/Makefile.in	2015-03-06 04:30:45.000000000 +0100
+++ 001__PORTED/mozilla-beta/toolkit/library/Makefile.in	2015-11-08 06:21:18.429244773 +0100
@@ -3,6 +3,7 @@
 # You can obtain one at http://mozilla.org/MPL/2.0/.
 
 include $(topsrcdir)/toolkit/library/libxul.mk
+include $(topsrcdir)/toolkit/library/autoconflibxul.mk
 
 include $(topsrcdir)/config/config.mk
 
--- 000__VANILLA/mozilla-beta/toolkit/library/autoconflibxul.mk	2015-11-08 06:23:04.967756467 +0100
+++ 001__PORTED/mozilla-beta/toolkit/library/autoconflibxul.mk	2015-11-08 11:17:36.033567064 +0100
@@ -0,0 +1,3 @@
+//MKSHLIB = /usr/bin/gld $(DSO_PIC_CFLAGS) $(DSO_LDOPTS) -h $(DSO_SONAME) -o $@
+//OS_LDFLAGS = -lpthread	 -z text -z ignore -R,'$$ORIGIN:$$ORIGIN/..' -z lazyload -z combreloc -z muldefs
+MKSHLIB = /usr/bin/env LD_ALTEXEC=/usr/bin/gld PATH=/usr/gcc/4.5/bin:/usr/gcc/4.7/bin:/usr/gcc/4.8/bin:$PATH $(CXX) $(CXXFLAGS) $(DSO_PIC_CFLAGS) $(DSO_LDOPTS) -Wl,-h,$(DSO_SONAME) -o $@
--- 000__VANILLA/mozilla-beta/js/xpconnect/shell/moz.build	2015-03-06 04:30:45.000000000 +0100
+++ 001__PORTED/mozilla-beta/js/xpconnect/shell/moz.build	2015-11-08 19:48:39.935054767 +0100
@@ -35,3 +35,14 @@
     RCINCLUDE = 'xpcshell.rc'
 
 FAIL_ON_WARNINGS = True
+
+OS_LIBS += [
+         '$(DEPTH)/security/nss/lib/util/libnssutil3.so',
+         '$(DEPTH)/security/nss/lib/ssl/libssl3.so',
+         '$(DEPTH)/security/nss/lib/smime/libsmime3.so',
+         '$(DEPTH)/security/nss/lib/nss/libnss3.so',
+         '$(DEPTH)/config/external/sqlite/libmozsqlite3.so',
+         '-lsendfile',
+         '-last'
+   ]
+
--- 000__VANILLA/mozilla-beta/ipc/app/moz.build	2015-03-06 04:30:37.000000000 +0100
+++ 001__PORTED/mozilla-beta/ipc/app/moz.build	2015-11-08 20:03:57.692159800 +0100
@@ -93,3 +93,14 @@
         'binder',
         'utils',
     ]
+
+OS_LIBS += [
+         '$(DEPTH)/security/nss/lib/util/libnssutil3.so',
+         '$(DEPTH)/security/nss/lib/ssl/libssl3.so',
+         '$(DEPTH)/security/nss/lib/smime/libsmime3.so',
+         '$(DEPTH)/security/nss/lib/nss/libnss3.so',
+         '$(DEPTH)/config/external/sqlite/libmozsqlite3.so',
+         '-lsendfile',
+         '-last'
+   ]
+
